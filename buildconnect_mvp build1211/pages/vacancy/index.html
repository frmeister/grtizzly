<!doctype html>
<html lang="ru"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Вакансия — Time Jobs</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
:root{--tj-accent:#4CFA00;--tj-bg:#0f0f0f}
.dotted-bg{background-color:var(--tj-bg);background-image:radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);background-size:24px 24px}
.glass-card{background:rgba(20,20,20,.6);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.06)}
.tj-btn{display:inline-flex;align-items:center;justify-content:center;border-radius:.7rem;padding:.6rem 1rem;border:1px solid rgba(255,255,255,.08)}
.tj-header{position:sticky;top:0;backdrop-filter:saturate(140%) blur(10px);background:rgba(10,10,10,.6);border-bottom:1px solid rgba(255,255,255,.06);z-index:40}
#tj-toast{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:8px;z-index:60}
.tj-toast-item{min-width:240px;max-width:360px;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#111;color:#e5e7eb;box-shadow:0 10px 30px rgba(0,0,0,.35);animation:tj-fade .25s ease-out}
.tj-toast-item.success{border-color:rgba(74,222,128,.35)}
.tj-toast-item.error{border-color:rgba(248,113,113,.35)}
@keyframes tj-fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.rounded-2xl{border-radius:1rem}
</style>

</head><body class="dotted-bg text-gray-200 antialiased">

<header class="tj-header">
  <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
    <div class="flex items-center gap-3 shrink-0">
      <div class="w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-slate-700 to-slate-900 ring-1 ring-white/5">
        <span class="text-white font-bold">TJ</span>
      </div>
      <div class="text-lg font-semibold">Time Jobs</div>
    </div>
    <nav class="flex items-center gap-4 text-sm text-gray-300">
      <a href="/index.html" class="hover:text-white">Главная</a>
      <a href="/pages/vacancies/index.html" class="hover:text-white">Вакансии</a>
      <a href="/pages/my/index.html" class="hover:text-white hidden" data-role="worker">Мои отклики</a>
      <a href="/pages/manage/index.html" class="hover:text-white hidden" data-role="employer">Отклики</a>
      <a href="/pages/post/index.html" class="hover:text-white hidden" data-role="employer">Разместить вакансию</a>
      <a href="/pages/support/index.html" class="hover:text-white hidden" data-role="moderator">Поддержка</a>
      <a href="/pages/manage/index.html" data-role="moderator" class="hidden px-3 py-1.5 rounded-lg bg-[var(--tj-accent)] text-black text-sm font-semibold hover:brightness-95">Модерация</a>
    </nav>
    <div id="authBlock" class="flex gap-2 items-center">
      <a class="tj-btn text-sm hover:bg-white/5" href="/pages/auth/login.html">Войти</a>
      <a class="tj-btn text-sm hover:bg-white/5" href="/pages/profile/index.html">Профиль</a>
    </div>
  </div>
</header>
<script>
(async()=>{
  try{
    const m=await (await fetch('/api/auth/me.php')).json();
    if(m.ok){
      const role=m.user.role;
      document.querySelectorAll('[data-role="'+role+'"]').forEach(el=>el.classList.remove('hidden'));
      const avatar=m.user.avatar&&m.user.avatar.trim()!==''?m.user.avatar:'https://ui-avatars.com/api/?background=0D8ABC&color=fff&name='+encodeURIComponent(m.user.name||'U');
      document.getElementById('authBlock').innerHTML='<a href="/pages/profile/index.html" title="Профиль"><img src="'+avatar+'" class="w-9 h-9 rounded-full ring-1 ring-white/10 object-cover"/></a>';
    }
  }catch(e){}
})();
</script>


<main class="max-w-4xl mx-auto px-6 mt-8"><div id="card" class="glass-card rounded-xl p-8"></div></main>
<script>
const id=new URLSearchParams(location.search).get('id');
(async()=>{
  const r=await fetch('/api/jobs/get.php?id='+id); if(!r.ok){card.innerHTML='<div>Вакансия недоступна</div>'; return;}
  const j=await r.json();
  card.innerHTML=`<h1 class="text-3xl font-bold text-white">${j.title}</h1>
  <p class="text-sm text-gray-400 mt-2">${j.city||'—'} • ${j.specialization||'—'} • ${j.pay_type==='hour'?'почасовая':'за смену'} • срок ${j.duration_days||1} дн.</p>
  <p class="text-lg text-green-400 font-semibold mt-4">${j.wage} ₽</p>
  <p class="text-sm text-gray-400 mt-1">Работодатель: <span class="text-white">${j.employer_name}</span> <span class="ml-2 text-xs px-2 py-0.5 rounded-full border border-white/10">${j.status}</span></p>
  <hr class="my-6 border-white/10" /><h2 class="text-xl font-semibold text-white">Описание</h2>
  <p class="text-gray-300 text-sm mt-2 whitespace-pre-line">${j.description||''}</p>
  <div class="mt-8 flex justify-between items-center"><p class="text-sm text-gray-400">Опубликовано: ${new Date(j.created_at).toLocaleDateString('ru-RU')}</p>
    <a id="applyBtn" class="px-6 py-3 rounded-lg bg-green-500 text-black font-semibold hover:bg-green-400 transition" href="#">Откликнуться</a></div>`;
  document.getElementById('applyBtn').addEventListener('click', async (e)=>{
    e.preventDefault();
    const note = prompt('Короткое сообщение работодателю:');
    if(note===null) return;
    const rr=await fetch('/api/apply/create.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({job_id:id,note})});
    const data=await rr.json();
    if(data.ok){ tjNotify('Отклик отправлен','success'); }
    else{ const map={duplicate:'Вы уже откликались', incomplete_profile:'Заполните контакты в профиле', auth:'Нужно войти'}; tjNotify(map[data.error]||('Ошибка: '+(data.error||'')),'error',3200); }
  });
})();
</script>


<script>
window.tjNotify=(msg,type='success',timeout=2600)=>{
  let wrap=document.getElementById('tj-toast'); if(!wrap){wrap=document.createElement('div');wrap.id='tj-toast';document.body.appendChild(wrap);}
  const div=document.createElement('div'); div.className='tj-toast-item '+(type||''); div.innerHTML=msg;
  wrap.appendChild(div); setTimeout(()=>{div.style.opacity=.0;div.style.transform='translateY(6px)';setTimeout(()=>div.remove(),220)}, timeout||2600);
};
</script>

</body></html>